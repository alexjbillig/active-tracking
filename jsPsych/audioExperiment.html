<!DOCTYPE html>
<html>
<head>
    <title>My auditory experiment</title>
    <script src="jsPsych-master/jspsych.js"></script>
    <script src="jsPsych-master/plugins/jspsych-html-keyboard-response.js"></script>
    <script src="jsPsych-master/plugins/jspsych-image-keyboard-response.js"></script>
    <script src="jsPsych-master/plugins/jspsych-audio-keyboard-response.js"></script>
    <link href="jsPsych-master/css/jspsych.css" rel="stylesheet" type="text/css"></link>
</head>
<body></body>

  <script>

  /* create timeline */
  var timeline = [];

  /* define welcome message trial */
  var welcome = {
    type: "html-keyboard-response",
    stimulus: "Welcome to the experiment. Press any key to begin."
  };
  timeline.push(welcome);

  /* define instructions trial */
  var instructions = {
    type: "html-keyboard-response",
    stimulus: "<p>In this experiment, you will adjust an ongoing sound.</p>" +
      "To make it more 'beepy' press and hold the letter B on the keyboard." +
      "</p><p> To make it more 'noisy' press and hold the letter N " +
      "on the keyboard.</p><p>Press any key to begin.</p>",
      post_trial_gap: 2000
    };
    timeline.push(instructions);

  /* preload soundfile */
  var sound_trial = {
      type: 'audio-keyboard-response',
      stimulus: 'audio/1_01norm.wav'
  }
  timeline.push(sound_trial)

  /* example AudioBuffer */
  var audioContext = new (window.AudioContext || window.webkitAudioContext)();

  // Create an empty three-second stereo buffer at the sample rate of the AudioContext
  var myArrayBuffer = audioContext.createBuffer(2, audioContext.sampleRate * 3, audioContext.sampleRate);

  // Fill the buffer with white noise;
  // just random values between -1.0 and 1.0
  for (var channel = 0; channel < myArrayBuffer.numberOfChannels; channel++) {
    // This gives us the actual array that contains the data
    var nowBuffering = myArrayBuffer.getChannelData(channel);
    for (var i = 0; i < myArrayBuffer.length; i++) {
      // Math.random() is in [0; 1.0]
      // audio needs to be in [-1.0; 1.0]
      nowBuffering[i] = Math.random() * 2 - 1;
    }
  }

  // Get an AudioBufferSourceNode.
  // This is the AudioNode to use when we want to play an AudioBuffer
  var source = audioContext.createBufferSource();

  // set the buffer in the AudioBufferSourceNode
  source.buffer = myArrayBuffer;

  // connect the AudioBufferSourceNode to the
  // destination so we can hear the sound
  source.connect(audioCtx.destination);

  // start the source playing
  source.start();

  /* start the experiment */
  /* jsPsych.init({
    timeline: timeline,
  });

  </script>

</html>
